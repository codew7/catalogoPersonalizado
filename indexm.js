function getUrlParameter(e){let t=new URLSearchParams(window.location.search);return t.get(e)}function parseCategoryPercentages(){let e=new URLSearchParams(window.location.search),t=new Map,n=e.get("c");if(!n)return t;try{let r=atob(n),a=0;for(;a<r.length;){let o=r.charCodeAt(a);if(++a+o>=r.length)break;let l="";for(let i=0;i<o;i++)l+=r[a],a++;let s=r.charCodeAt(a);a++,t.set(l,s)}}catch(c){console.error("Error al decodificar categor\xedas:",c)}return t}const customName=getUrlParameter("n")||"Cat\xe1logo",categoryPercentages=parseCategoryPercentages();function getPorcentajeParaCategoria(e){return categoryPercentages.get(e)||0}document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector(".header-content-mobile .mayorista-text"),t=document.querySelector(".header-content-desktop .mayorista-text");e&&(e.textContent=customName),t&&(t.textContent=customName),"Cat\xe1logo"!==customName&&(document.title=`Cat\xe1logo - ${customName}`);let n=document.getElementById("footer-catalog-name");n&&(n.textContent=customName)});const ITEMS_PER_PAGE=30;let productos=[],currentPage=1,currentLightboxImages=[],currentImageIndex=0,primeraCarga=!0;const loadingOverlay=document.getElementById("loadingOverlay");function mostrarPagina(e,t=productos){currentPage=e,t.length;let n=(e-1)*30,r=t.slice(n,n+30);cargarGrid(r),actualizarPaginacion(e,t),document.activeElement!==document.getElementById("buscar")&&setTimeout(()=>{if(primeraCarga)window.scrollTo({top:0,behavior:"auto"});else{let e=document.getElementById("categorias");if(e){let t=e.getBoundingClientRect(),n=window.pageYOffset||document.documentElement.scrollTop;window.scrollTo({top:t.top+n-20,behavior:"smooth"})}}},0)}function cargarGrid(e){let t=document.getElementById("catalogo");t.innerHTML="",e.forEach(e=>{let n=document.createElement("div");n.classList.add("card");let r=document.createElement("input");if(r.type="hidden",r.value=e[2],n.appendChild(r),isValidImageUrl(e[1])){let a=[];-1!==e[1].indexOf(",")?a=e[1].split(",").map(e=>e.trim()):a.push(e[1]);let o=document.createElement("img");o.src=a[0],o.loading="lazy",o.onerror=function(){this.src="no-disponible.png"},o.addEventListener("click",()=>{abrirLightbox(a)}),n.appendChild(o)}let l=document.createElement("h3");l.textContent=e[3],n.appendChild(l);let i=document.createElement("div");i.classList.add("info"),i.textContent=`C\xf3digo: ${e[2]}`,n.appendChild(i);let s=document.createElement("div");s.classList.add("stock-info"),s.style.margin="5px 0",s.style.fontWeight="bold";let c=0;void 0!==e[10]&&null!==e[10]&&""!==e[10]&&(c=parseInt(e[10])),isNaN(c)?s.innerHTML=`<span style="color: #ff9800;">✗ Sin stock</span>`:c<=5?s.innerHTML=`<span style="color: #ff9800;">✗ Sin stock</span>`:c<=15?s.innerHTML=`<span style="color: #ffeb3b;">⚠ Pocas unidades</span>`:s.innerHTML=`<span style="color: #4CAF50;">✓ Disponible</span>`,n.appendChild(s);let g=e[7],d=getPorcentajeParaCategoria(g);if(d>0){let u=document.createElement("p"),m=(parseFloat((e[6]||"0").toString().replace(/,/g,""))||0)*(1+d/100);m=10*Math.round((m=Math.round(m))/10),u.innerHTML=`<strong>Precio $</strong> ${m.toLocaleString("es-AR")}`,u.style.marginTop="2px",n.appendChild(u)}n.appendChild(s),t.appendChild(n)})}function refreshStockInfo(){let e=document.querySelectorAll(".card");e.forEach(e=>{let t=e.querySelector(".stock-info");if(t){let n=e.querySelector('input[type="hidden"]');if(n){let r=n.value,a=productos.find(e=>e[2]===r),o=0;a&&void 0!==a[10]&&null!==a[10]&&""!==a[10]&&(o=parseInt(a[10])),isNaN(o)?t.innerHTML=`<span style="color: #ff9800;">✗ Sin stock</span>`:o<=5?t.innerHTML=`<span style="color: #ff9800;">✗ Sin stock</span>`:o<=15?t.innerHTML=`<span style="color: #ffeb3b;">⚠ Pocas unidades</span>`:t.innerHTML=`<span style="color: #4CAF50;">✓ Disponible</span>`}}})}function getMaxVisiblePaginationButtons(){let e=document.getElementById("pagination"),t=window.innerWidth;e&&(t=e.offsetWidth||t);let n=Math.max(3,Math.floor((t-220)/48));return Math.min(n,15)}function actualizarPaginacion(e,t){let n=document.getElementById("pagination");n.innerHTML="";let r=Math.ceil(t.length/30);if(e>1){let a=document.createElement("button");a.textContent="Anterior",a.style.width="100px",a.addEventListener("click",()=>mostrarPagina(e-1,t)),n.appendChild(a)}let o=getMaxVisiblePaginationButtons(),l=Math.max(1,e-Math.floor(o/2)),i=Math.min(r,l+o-1);i-l<o-1&&(l=Math.max(1,i-o+1));for(let s=l;s<=i;s++){let c=document.createElement("button");c.textContent=s,c.classList.add("pagination-button"),s===e&&c.classList.add("active"),c.addEventListener("click",()=>mostrarPagina(s,t)),n.appendChild(c)}if(e<r){let g=document.createElement("button");g.textContent="Siguiente",g.style.width="100px",g.addEventListener("click",()=>mostrarPagina(e+1,t)),n.appendChild(g)}}function isValidImageUrl(e){return e&&e.match(/\.(jpeg|jpg|gif|png)$/i)}function abrirLightbox(e){currentLightboxImages=e,currentImageIndex=0,document.getElementById("lightbox-img").src=currentLightboxImages[currentImageIndex],document.getElementById("lightbox").style.display="flex",actualizarBotonesLightbox()}function actualizarBotonesLightbox(){let e=document.getElementById("prev-btn"),t=document.getElementById("next-btn");currentLightboxImages.length>1?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}function closeLightbox(e){(e.target===e.currentTarget||e.target.classList.contains("close"))&&(document.getElementById("lightbox").style.display="none")}fetch(`https://sheets.googleapis.com/v4/spreadsheets/${G_S_CONFIG.SPREADSHEET_ID}/values/${G_S_CONFIG.RANGO}?key=${G_S_CONFIG.API_KEY}`).then(e=>{if(!e.ok)throw Error(`Error al acceder a la API: ${e.statusText}`);return e.json()}).then(e=>{loadingOverlay&&(loadingOverlay.style.display="none");let t=e.values;if(!t||0===t.length)throw Error("No se encontraron datos en la hoja.");productos=t.filter(e=>{if("no disponible"===e[4].toLowerCase())return!1;let t=0;if(void 0!==e[10]&&null!==e[10]&&""!==e[10]&&(t=parseInt(e[10])),isNaN(t)||t<=0)return!1;if(categoryPercentages.size>0){let n=e[7];return categoryPercentages.has(n)}return!0}).sort((e,t)=>{function n(e){if(!e||""===e||null==e)return new Date(1900,0,1);if(e.includes("/")){let t=e.split("/");if(3===t.length){let n=parseInt(t[0]),r=parseInt(t[1])-1,a=parseInt(t[2]);return new Date(a,r,n)}}return new Date(1900,0,1)}let r=n(e[12]),a=n(t[12]);return a-r}),window.scrollTo(0,0),mostrarPagina(1),setTimeout(()=>{refreshStockInfo(),setTimeout(()=>{primeraCarga=!1},100)},100);let n=new Set(productos.map(e=>e[0])),r=document.getElementById("categorias"),a=Array.from(n).filter(e=>e&&""!==e.trim()).sort((e,t)=>e.localeCompare(t,"es",{sensitivity:"base"}));function o(){let e=document.getElementById("categorias").value,t=document.getElementById("buscar").value.toLowerCase(),n=productos;"todos"!==e&&(n=n.filter(t=>t[0]===e)),""!==t.trim()&&(n=n.filter(e=>e[3].toLowerCase().includes(t)||e[2].toLowerCase().includes(t))),mostrarPagina(1,n)}a.forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),r.addEventListener("change",()=>{o()}),document.getElementById("buscar").addEventListener("input",e=>{o()}),document.getElementById("todos").addEventListener("click",()=>{document.getElementById("categorias").value="todos",document.getElementById("buscar").value="",mostrarPagina(1)})}).catch(e=>{loadingOverlay&&(loadingOverlay.style.display="none"),console.error("Error al cargar los datos:",e),document.querySelector("#error").textContent=e.message}),window.addEventListener("resize",()=>{void 0!==currentPage&&void 0!==productos&&actualizarPaginacion(currentPage,productos)}),document.getElementById("next-btn").addEventListener("click",e=>{e.stopPropagation(),currentLightboxImages.length>0&&(currentImageIndex=(currentImageIndex+1)%currentLightboxImages.length,document.getElementById("lightbox-img").src=currentLightboxImages[currentImageIndex])}),document.getElementById("prev-btn").addEventListener("click",e=>{e.stopPropagation(),currentLightboxImages.length>0&&(currentImageIndex=(currentLightboxImages.length+currentImageIndex-1)%currentLightboxImages.length,document.getElementById("lightbox-img").src=currentLightboxImages[currentImageIndex])}),document.getElementById("lightbox-img").addEventListener("error",function(){currentLightboxImages.length>0&&0!==currentImageIndex&&(currentImageIndex=0,this.src=currentLightboxImages[0])});
